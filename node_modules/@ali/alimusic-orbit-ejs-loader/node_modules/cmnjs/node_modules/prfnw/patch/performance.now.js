(function (global) {

  if ('performance' in global === false) {
    global.performance = {};
  }

  Date.now = (Date.now || function () {  // thanks IE8
    return new Date().getTime();
  });

  if ('now' in global.performance === false) {

    var nowOffset = Date.now();

    if (global.performance.timing &&
      global.performance.timing.navigationStart) {
      nowOffset = global.performance.timing.navigationStart;
    }

    global.performance.now = function now() {
      return Date.now() - nowOffset;
    };

  }

}(window || global));
