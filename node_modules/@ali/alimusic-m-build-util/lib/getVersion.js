var fs = require('fs'),
  path = require('path'),
  versionReg = /(\d{1,}\.\d{1,}\.\d{1,})/gi;

//获取当前分支
function getCurrentBranch(fp) {
  //ref: refs/heads/daily/3.0.0
  //ref: refs/heads/master
  var branch = '';
  fp = fp || process.cwd();
  try {
    var gitHead = fs.readFileSync(path.join(fp, '.git/HEAD')).toString();
    branch = gitHead.replace('ref: refs/heads/', '');
  } catch (e) {
    return '';
  }
  return branch;
}

function getVersion(fp) {

  var version = '';

  //获取版本号
  version = getCurrentBranch(fp) || '';
  if (!version) {
    console.log('请切换到相应的daily/0.0.x分支开发');
  } else {
    version = version.match(versionReg);
    version = version && version[0];
  }

  return version;
}

module.exports = getVersion;