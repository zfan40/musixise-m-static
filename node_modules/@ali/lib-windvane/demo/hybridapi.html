<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="user-scalable=no, width=device-width, minimum-scale=1, maximum-scale=1" />
<title>Hybrid API Demo</title>
<style type="text/css">
body{
    margin: 0;
}
.container{
    position: relative;
    overflow-y: scroll;
}
.item{
    position: relative;
    font-family: arial;
    font-size: 16px;
    padding: 15px 10px;
}
.item:nth-child(2n){
    background-color: #f0f0f0;
}
.item p{
    margin: 0;
    padding: 0;
    margin-right: 70px;
}
.item a{
    padding: 4px 15px;
    margin-left: 5px;
    float: right;
    position: absolute;
    right: 10px;
    top: 10px;
    background-color: #ccc;
    border-radius: 15px;
    border: 1px solid #999;
    -webkit-tap-highlight-color: rgba(0,0,0,0);
}
.debug-log{
    position: fixed !important;
    bottom: 0;
    top: auto !important;
    height: 150px !important;
}
</style>
<script type="text/javascript" src='http://g.tbcdn.cn/mtb/app-618h5/1.0.8/js/debug.js'></script>
<script type="text/javascript" src="http://g.tbcdn.cn/mtb/lib-login/1.1.2/login.js"></script>
<script type="text/javascript" src="../src/windvane.js"></script>
<script type="text/javascript" src="../src/hybridapi.js"></script>
</head>

<script type="text/javascript">
var Ali = lib.Ali;
var watchIds = {};

var testSuit = {
    toast: function(){
        Ali.toast('Hello World!', function(result){
            console.log('toast', JSON.stringify(result));
        });
    },

    setTitle: function(){
        Ali.setTitle('Hello Hybrid API', function(result){
            console.log('setTitle', JSON.stringify(result));
        });
    },

    showTitle: function(){
        Ali.showTitle(function(result){
            console.log('showTitle', JSON.stringify(result));
        });
    },

    hideTitle: function(){
        Ali.hideTitle(function(result){
            console.log('hideTitle', JSON.stringify(result));
        });
    },

    pushWindow: function(){
        Ali.pushWindow('http://m.tmall.com', function(result){
            console.log('pushWindow', JSON.stringify(result));
        });
    },

    popWindow: function(){
        Ali.popWindow(function(result){
            console.log('popWindow', JSON.stringify(result));
        });
    },

    login: function(){
        Ali.login(function(result){
            console.log('login', JSON.stringify(result));
        });
    },

    h5TradePay: function(){
        var options = {
            signStr: '',
            alipayURL: '',
            backURL: '',
            unSuccessUrl: ''
        };
        Ali.h5TradePay(options, function(result){
            console.log('tradePay', JSON.stringify(result));
        });
    },

    geolocation: {
        getCurrentPosition: function(){
            Ali.geolocation.getCurrentPosition({
                enableHighAcuracy:true, 
                address:true
            }, function(result){
                console.log('geolocation.getCurrentPosition', JSON.stringify(result));
            });
        }
    },

    shake: {
        watch: function(){
            watchIds['shake'] = Ali.shake.watch(null, function(result){
                if(result && result.type === 'motion.shake'){
                    console.log('onShake');
                }else{
                    console.log('shake.watch', result && JSON.stringify(result));
                }
            });
        },

        clearWatch: function(){
            Ali.shake.clearWatch(watchIds['shake'], function(result){
                console.log('shake.clearWatch', JSON.stringify(result));
            });
        }
    },

    vibration: {
        vibrate: function(){
            Ali.vibration.vibrate(5000, function(result){
                console.log('vibration.vibrate', JSON.stringify(result));
            });
        }
    },

    network: {
        getType: function(){
            Ali.network.getType(function(result){
                console.log('network.getType', JSON.stringify(result));
            });
        }
    },

    audio: {
        play: function(){
            var url = 'http://zhenglin.x.taobao.net/mtb/lib-windvane/demo/example.mp3';
            Ali.audio.play(url, function(result){
                console.log('audio.play', JSON.stringify(result));
            });
        },
        stop: function(){
            var url = 'http://zhenglin.x.taobao.net/mtb/lib-windvane/demo/example.mp3';
            Ali.audio.stop(url, function(result){
                console.log('audio.stop', JSON.stringify(result));
            });
        }
    },

    calendar: {
        add: function(){
            var options = {
                title: 'test',
                // startTime: '20140728225000',
                // endTime: '20140820170000',
                startDate: "2014-12-09 14:20:00",
                endDate: "2014-12-09 14:40:00",
                link: 'http://h5.m.taobao.com/wc/home-page.html',
                eventId: 1001,
                sourceId: 8003
            };
            Ali.calendar.add(options, function(result){
                console.log('calendar.add', JSON.stringify(result));
            });
        }
    },

    photo: function(){
        var options = {
            dataType: 'dataurl',
            allowedEdit: true,
            src: 'gallery', //camera
            maxWidth: 1000,
            maxHeight: 1000,
            format: 'jpg', //png
            quality: 80 //0-100
        };
        Ali.photo(options, function(result){
            console.log('photo', JSON.stringify(result));
        });
    },

    contacts: {
        get: function(){
            Ali.contacts.get(null, function(result){
                console.log('contacts.get', JSON.stringify(result));
            });
        }
    },

    showLoading: function(){
        Ali.showLoading(null, function(result){
            console.log('showLoading', JSON.stringify(result));
        });
    },

    hideLoading: function(){
        Ali.hideLoading(function(result){
            console.log('hideLoading', JSON.stringify(result));
        });
    },
}

function initTestSuite(){
    var frag = document.createDocumentFragment();

    for(var p in testSuit){
        var obj = testSuit[p];
        var path = [p];
        if(typeof obj === 'function'){
            frag.appendChild(createTestItem(path, obj));
        }else{
            for(var cp in obj){
                frag.appendChild(createTestItem(path.concat(cp), obj[cp]));
            }
        }
    }

    var container = document.createElement('div');
    container.className = 'container';
    container.style.height = (window.innerHeight - 150) + 'px';
    container.appendChild(frag);
    document.body.appendChild(container);

    window.addEventListener('resize', function(){
        container.style.height = (window.innerHeight - 150) + 'px';
    });
}

function createTestItem(path, item){
    var name = path.join ? path.join('.') : path;
    
    //lable
    var label = document.createElement('p');
    label.innerHTML = name;

    //exec button
    var btn = document.createElement('a');
    btn.innerHTML = 'Run';
    btn.id = name;
    btn.addEventListener('click', function(){
        var obj = testSuit, arr = this.id.split('.'), p;
        while((p = arr.shift()) && (obj = obj[p]));
        if(typeof obj === 'function'){
            console.log('run: ' + this.id);
            obj();
        }
    });

    //container
    var div = document.createElement('div');
    div.className = 'item';
    div.appendChild(label);
    div.appendChild(btn);
    return div;
}

window.addEventListener('load', function(){
    console.log(navigator.userAgent);
    Ali && console.log(JSON.stringify(Ali.appinfo));
    initTestSuite();
});

</script>

</html>